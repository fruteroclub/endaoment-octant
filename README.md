# Endaoment: Bridging Degens ğŸ¤ Regens Through Yield-Powered Student Funding

> **A regenerative public goods protocol that transforms speculative yield into sustainable student research funding, embodying the Degen ğŸ¤ Regen synergy.**

## ğŸŒ± What is Endaoment?

**Endaoment** is a decentralized protocol that enables anyone to support student research initiatives while earning yield exposure. It combines:

- **YieldDonating Strategies (YDS)** from Octant - generating yield from DeFi protocols like Aave
- **RegenStaker** - representing student voting power through staking
- **AllocationManager** - democratically distributing yield based on weighted votes

### The Problem We Solve

Traditional funding models for students and public goods face critical challenges:
- **Limited scalability**: Traditional grants can't scale with demand
- **Coordination failures**: Donors and beneficiaries struggle to align incentives
- **Speculative waste**: Degen energy generates yield but lacks purpose
- **Slow execution**: Regen projects move too slowly to capture momentum

### Our Solution: The Regenerative Flywheel

Endaoment creates a **self-sustaining system** where:

1. **Degens** deposit assets â†’ Generate yield through Aave/DeFi protocols ğŸš€
2. **Yield is donated** â†’ 100% of profits go to public goods (no fees) ğŸ’°
3. **Students stake** â†’ Build voting power through RegenStaker ğŸ„
4. **Weighted voting** â†’ Depositors + students vote on funding allocation ğŸ—³ï¸
5. **Yield distribution** â†’ 10% whale / 15% retail / 75% students (weighted by votes) ğŸ“Š
6. **Sustainable funding** â†’ Students receive continuous support for research ğŸŒ±

**Result**: Speculative energy (Degen) fuels regenerative impact (Regen) â†’ **1 + 1 = 3** âš¡

---

## ğŸ©ğŸ¤ğŸ„ The Degen ğŸ¤ Regen Connection

Endaoment embodies the **Degens ğŸ¤ Regens Manifesto** by creating a bridge between two complementary forces:

### How Degens Benefit
- âœ… **Yield exposure** without fees - deposit assets, earn yield, support public goods
- âœ… **Viral coordination** - participate in funding decisions through voting
- âœ… **Purpose-driven speculation** - your yield directly funds student research
- âœ… **Transparent impact** - see exactly how your deposits create value

### How Regens Benefit
- âœ… **Sustainable funding** - continuous yield streams replace one-time grants
- âœ… **Democratized allocation** - students and depositors vote together
- âœ… **Scalable infrastructure** - protocol handles distribution automatically
- âœ… **Aligned incentives** - students with more staking power get more funding

### The Synergy
When **Degens and Regens collaborate** in Endaoment:
- **Degen energy** (liquidity + yield) â†’ **Regen structure** (student funding) â†’ **Exponential impact** ğŸš€ğŸŒ±âš¡

This is **not zero-sum**â€”it's about multiplying value through coordination.

---

## ğŸ”„ How It Works

### Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ENDAOMENT PROTOCOL FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. DEPOSIT PHASE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Degens  â”‚â”€â”€â”€â”€â”€â–¶â”‚  YDS Vault   â”‚â”€â”€â”€â”€â”€â–¶â”‚ Aave Pool   â”‚
   â”‚ (Whale/  â”‚      â”‚ (ERC-4626)   â”‚      â”‚ (Yield Gen) â”‚
   â”‚  Retail) â”‚      â”‚              â”‚      â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ (yield generated)
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ AllocationMgr â”‚
                    â”‚ (dragonRouter)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. STUDENT PHASE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Students â”‚â”€â”€â”€â”€â”€â–¶â”‚ RegenStaker  â”‚â”€â”€â”€â”€â”€â–¶â”‚ StudentVotingâ”‚
   â”‚  Stake   â”‚      â”‚ (Earning Pwr)â”‚      â”‚ (Proposals) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. VOTING PHASE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Depositors   â”‚â”€â”€â”€â”€â”€â–¶â”‚ AllocationMgrâ”‚
   â”‚ Allocate     â”‚      â”‚ (Weighted    â”‚
   â”‚ Votes        â”‚      â”‚  Votes)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Weighted Voteâ”‚
            â”‚ Calculation  â”‚
            â”‚ = Depositor  â”‚
            â”‚   Vote Ã—     â”‚
            â”‚   (Student   â”‚
            â”‚   Power +    â”‚
            â”‚   Proposal   â”‚
            â”‚   Votes)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. DISTRIBUTION PHASE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AllocationMgrâ”‚
   â”‚ Redeems      â”‚
   â”‚ Shares       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ 10% â”€â”€â–¶ Whale (vault creator)
         â”œâ”€â”€â”€ 15% â”€â”€â–¶ Retail (proportional to shares)
         â””â”€â”€â”€ 75% â”€â”€â–¶ Students (proportional to weighted votes)
```

### Key Components

1. **YieldDonating Strategy (YDS)**
   - ERC-4626 compliant vault
   - Deploys assets to Aave V3 Pool
   - Detects profit and mints shares to `AllocationManager`
   - **Zero fees** - all yield donated

2. **RegenStaker** (from octant-v2-core)
   - Students stake ENDAO tokens to build earning power
   - Earning power = voting power for proposals
   - Represents student commitment and engagement
   - Full rewards distribution system for student incentives
   - Open staking (AccessMode.NONE) - permissionless participation

3. **StudentVoting**
   - Students vote for proposals (other students)
   - Uses earning power from RegenStaker
   - Tracks votes per epoch

4. **AllocationManager**
   - Manages 30-day epochs
   - Collects YDS profit shares
   - Calculates weighted votes (depositor + student power)
   - Distributes yield: 10% whale / 15% retail / 75% students

5. **StudentRegistry**
   - Manages verified student profiles
   - Tracks funding received
   - Ensures only active students can participate

---

## ğŸ’ Value Proposition

### For Depositors (Degens)
- **Yield exposure** with zero fees
- **Impact transparency** - see exactly where your yield goes
- **Voting power** - influence funding allocation
- **Public goods contribution** - 100% of profits fund students

### For Students (Regens)
- **Sustainable funding** - continuous yield streams
- **Democratized access** - vote for proposals, receive funding
- **Staking rewards** - more staking = more voting power = more funding
- **Transparent allocation** - weighted voting ensures fair distribution

### For the Ecosystem
- **Regenerative flywheel** - speculative energy â†’ sustainable funding
- **Scalable infrastructure** - protocol handles distribution automatically
- **Aligned incentives** - everyone benefits from protocol success
- **Public good** - anyone can participate, no barriers to entry

---

## ğŸ—ï¸ Technical Architecture

### Contracts

```
src/
â”œâ”€â”€ strategies/
â”‚   â””â”€â”€ yieldDonating/
â”‚       â””â”€â”€ YieldDonatingStrategy.sol    # YDS vault (Aave integration)
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ AllocationManager.sol            # Yield distribution & epochs
â”‚   â”œâ”€â”€ StudentVoting.sol                 # Student proposal voting
â”‚   â””â”€â”€ StudentRegistry.sol               # Student profile management
â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ IRegenStaker.sol                  # RegenStaker interface
â”‚   â””â”€â”€ IStudentRegistry.sol              # StudentRegistry interface
â”œâ”€â”€ tokens/
â”‚   â””â”€â”€ EndaomentToken.sol                # ENDAO token (ERC20Permit) for staking
â””â”€â”€ test/
    â”œâ”€â”€ integration/
    â”‚   â””â”€â”€ RegenStakerYDSIntegration.t.sol  # Full integration tests
    â””â”€â”€ helpers/
        â””â”€â”€ RegenStakerSetup.sol             # RegenStaker deployment helper
```

### Integration Points

- **Octant YDS**: Uses `YieldDonatingTokenizedStrategy` for profit donation
- **Aave V3**: Real mainnet integration via fork testing
  - **Aave Earn Vault (ERC-4626)**: YDS uses vault as yield source - see [Vault Integration](./docs/vault-integration-summary.md)
  - Vault wraps Aave Pool for standardized interface and simplified accounting
- **RegenStaker** (octant-v2-core): Real implementation for student voting power
  - Students stake ENDAO tokens to build earning power
  - Full rewards distribution system
  - Open staking (permissionless)
  - Integrated via `RegenStakerWithoutDelegateSurrogateVotes`
- **ERC-4626**: Standard vault interface for deposits/withdrawals

---

## ğŸ¯ How to Demonstrate Endaoment (For Hackathon Judges)

### Quick Demo Script

```bash
# 1. Set up environment
cp .env.example .env
# Add your ETH_RPC_URL and configure TEST_ASSET_ADDRESS, TEST_YIELD_SOURCE

# 2. Install dependencies
forge install
forge soldeer install

# 3. Run Aave Vault tests (visual output showing protocol benefits)
forge test --match-test test_completeFlow \
  --fork-url $ETH_RPC_URL \
  --fork-block-number 20000000 \
  -vvv

# 4. Run full integration tests (complete Endaoment flow)
forge test --match-contract RegenStakerYDSIntegrationTest \
  --fork-url $ETH_RPC_URL \
  --fork-block-number 20000000 \
  -vvv
```

> **ğŸ’¡ Tip**: The Aave Vault tests include **visual CLI output** that clearly shows each step and protocol benefits. Perfect for hackathon demos! See [Aave Vault Testing Guide](./docs/aave-vault-testing.md) for details.

### What the Tests Demonstrate

The integration tests (`RegenStakerYDSIntegration.t.sol`) showcase:

1. **Complete Flow** (`test_completeIntegrationFlow`)
   - âœ… Deposits generate yield through Aave
   - âœ… Profit shares minted to AllocationManager
   - âœ… Weighted voting combines depositor + student power
   - âœ… Yield distributed: 10% whale / 15% retail / 75% students
   - âœ… Student funding recorded in registry

2. **Weighted Voting** (`test_weightedVoteCalculation`)
   - âœ… Students with earning power get amplified votes
   - âœ… Fair distribution based on engagement

3. **Student Power Impact** (`test_studentVotingPowerAffectsAllocation`)
   - âœ… Higher staking power = more funding
   - âœ… Incentivizes student participation

4. **Epoch Management** (`test_epochManagement`)
   - âœ… 30-day epochs with automatic transitions
   - âœ… Synchronized voting and distribution

5. **Security** (`test_shareRedemptionPreventsDoubleRedemption`)
   - âœ… Prevents double redemption attacks
   - âœ… Safe share management

### Key Metrics to Highlight

- **Zero fees**: 100% of yield donated (no performance fees)
- **Real yield**: Generated from Aave V3 on mainnet fork
- **Weighted democracy**: Depositor votes Ã— student power
- **Fair distribution**: 75% to students, 15% to retail, 10% to whale
- **Scalable**: Protocol handles distribution automatically

### Demo Narrative

1. **"Degens deposit"** â†’ Show whale/retail deposits to YDS vault
2. **"Yield generates"** â†’ Demonstrate Aave yield generation (skip 30 days)
3. **"Students stake"** â†’ Show students staking ENDAO tokens in RegenStaker to build earning power
4. **"Voting happens"** â†’ Show depositor + student votes
5. **"Yield distributes"** â†’ Show 10/15/75 split to recipients
6. **"Impact recorded"** â†’ Show student funding in registry

**Key Point**: "This is the Degen ğŸ¤ Regen synergy in action - speculative yield becomes sustainable student funding."

---

## ğŸ§ª Testing & Verification

### Running Tests

```bash
# All integration tests
make test

# Specific test suite
forge test --match-contract RegenStakerYDSIntegrationTest \
  --fork-url $(grep '^ETH_RPC_URL=' .env | cut -d '=' -f2-) \
  --fork-block-number 20000000

# With verbose output
forge test --match-contract RegenStakerYDSIntegrationTest -vvv
```

### Test Coverage

- âœ… Complete integration flow (deposit â†’ yield â†’ distribution)
- âœ… Weighted vote calculation
- âœ… Student power affects allocation
- âœ… Epoch management
- âœ… Share redemption protection
- âœ… Real Aave yield generation (mainnet fork)
- âœ… Real RegenStaker integration (from octant-v2-core)
- âœ… Full staking and rewards distribution flow

### Verification Checklist

- [x] YDS generates real yield from Aave
- [x] Profit shares minted to AllocationManager
- [x] Weighted votes calculated correctly
- [x] Yield distributed: 10% whale / 15% retail / 75% students
- [x] Student funding recorded in registry
- [x] Epochs transition correctly
- [x] No double redemption possible

---

## ğŸš€ Getting Started

### Prerequisites

1. Install [Foundry](https://book.getfoundry.sh/getting-started/installation)
2. Install [Node.js](https://nodejs.org/)
3. Get an Ethereum RPC URL (Infura, Alchemy, etc.)

### Setup

```bash
# Clone repository
git clone git@github.com:golemfoundation/octant-v2-strategy-foundry-mix.git
cd octant-v2-strategy-foundry-mix

# Install dependencies
forge install
forge soldeer install

# Configure environment
cp .env.example .env
# Edit .env with your ETH_RPC_URL, TEST_ASSET_ADDRESS, TEST_YIELD_SOURCE
```

### Environment Variables

```env
# Required for testing
TEST_ASSET_ADDRESS=0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48  # USDC
TEST_YIELD_SOURCE=0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2   # Aave V3 Pool

# RPC URLs
ETH_RPC_URL=https://mainnet.infura.io/v3/YOUR_API_KEY
```

### Run Tests

```bash
# All tests
make test

# Integration tests only
forge test --match-contract RegenStakerYDSIntegrationTest \
  --fork-url $ETH_RPC_URL \
  --fork-block-number 20000000
```

---

## ğŸ“š Documentation

- **[Project Analysis](./docs/project-analysis.md)** - Deep dive into Octant YDS architecture
- **[Integration Implementation](./docs/regenstaker-integration-implementation.md)** - Technical implementation details
- **[Integration Tests](./docs/integration-tests-summary.md)** - Test suite documentation
- **[Aave Vault Deployment](./docs/aave-vault-deployment.md)** - Deploy ERC-4626 Aave Earn Vault
- **[Aave Vault Testing](./docs/aave-vault-testing.md)** - Visual testing guide with CLI output
- **[Degen ğŸ¤ Regen Manifesto](./docs/regen/degensxregens.md)** - Philosophy and vision

---

## ğŸ¯ Success Criteria

Endaoment succeeds when:

1. âœ… **Yield generates** - Real yield from Aave V3 (verified on fork)
2. âœ… **Profits donated** - 100% of profits minted to AllocationManager
3. âœ… **Voting works** - Weighted votes combine depositor + student power
4. âœ… **Distribution fair** - 10/15/75 split executed correctly
5. âœ… **Students funded** - Funding recorded and distributed
6. âœ… **Scalable** - Protocol handles multiple epochs and vaults
7. âœ… **Public good** - Anyone can participate, no barriers

---

## ğŸ¤ Contributing

This project is part of the **Endaoment** initiative, bridging Degens ğŸ¤ Regens through yield-powered public goods funding.

### Key Principles

- **We believe in Degens** ğŸ© ability to discover and spread the word
- **We believe in Regens** ğŸ„ ability to align towards systemic solutions
- **We believe Degens ğŸ¤ Regens** together multiply coordination and public goods

---

## ğŸ“„ License

[Add your license here]

---

## ğŸ™ Acknowledgments

- **Octant** - YieldDonating Strategy framework
- **Aave** - Yield source protocol
- **RegenStaker** (octant-v2-core) - Student voting power mechanism with full staking and rewards
- **The Degen ğŸ¤ Regen Community** - Inspiration and vision

---

**Join the Movement. Let's Regen Together.** ğŸŒ±ğŸ©

*"Speculative energy fuels sustainability. Coordination becomes exponential."*
